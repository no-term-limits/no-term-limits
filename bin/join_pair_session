#!/usr/bin/env bash

function error_handler() {
  >&2 echo "Exited with BAD EXIT CODE '${2}' in ${0} script at line: ${1}."
  exit "$2"
}
trap 'error_handler ${LINENO} $?' ERR
set -o errtrace -o errexit -o nounset -o pipefail

# Get the original user who started the pairing session
original_user=$(cat /var/tmp/no_term_limits_pair_session_owner 2>/dev/null || echo "")
if [[ -z "$original_user" ]]; then
  >&2 echo "ERROR: Could not determine original pairing session owner"
  exit 1
fi

# Find zellij binary
zellij_path=$(which zellij 2>/dev/null || echo "")
if [[ -z "$zellij_path" ]]; then
  >&2 echo "ERROR: Could not find zellij binary"
  exit 1
fi

exec sudo -u "$original_user" "$zellij_path" attach pair
